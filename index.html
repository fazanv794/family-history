<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Fix</title>
</head>
<body>
    <h1>–¢–µ—Å—Ç Supabase</h1>
    <div>
        <button id="testBtn">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
        <button id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        <button id="loginBtn">–í–æ–π—Ç–∏</button>
        <button id="logoutBtn">–í—ã–π—Ç–∏</button>
    </div>
    
    <div id="output" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; min-height: 100px;"></div>

    <!-- UMD –≤–µ—Ä—Å–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    
    <script>
        // –ü—Ä–æ—Å—Ç–æ–π –≤—ã–≤–æ–¥ –≤ HTML
        function log(msg) {
            const output = document.getElementById('output');
            output.innerHTML += msg + '<br>';
            console.log(msg);
        }
        
        log('1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
        setTimeout(() => {
            initSupabase();
        }, 100);
        
        function initSupabase() {
            log('2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Supabase...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
            if (typeof supabase !== 'undefined') {
                log('‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–∞–∫ "supabase"');
            } else if (window.supabase) {
                log('‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–∞–∫ "window.supabase"');
            } else {
                log('‚ùå –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å');
                return;
            }
            
            // –¢–≤–æ–∏ –∫–ª—é—á–∏
            const SUPABASE_URL = 'https://ejbdehqypaotjnsiunny.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqYmRlaHF5cGFvdGpuc2l1bm55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0MDg2MzQsImV4cCI6MjA4MDk4NDYzNH0.hDWtZLUtMgg266d4LpFsKaOfKF1zAPt1JFN8OtqbLFk';
            
            try {
                // –°–ü–û–°–û–ë 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π supabase
                let supabaseClient;
                
                if (typeof supabase !== 'undefined' && supabase.createClient) {
                    // –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–µ–±—è –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é supabase
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    log('–°–æ–∑–¥–∞–Ω–æ —á–µ—Ä–µ–∑ supabase.createClient()');
                } 
                else if (window.supabase && window.supabase.createClient) {
                    // –ò–ª–∏ —á–µ—Ä–µ–∑ window.supabase
                    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    log('–°–æ–∑–¥–∞–Ω–æ —á–µ—Ä–µ–∑ window.supabase.createClient()');
                }
                else {
                    log('‚ùå –ù–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ –º–µ—Ç–æ–¥ createClient');
                    return;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ
                window.supabase = supabaseClient;
                log('‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω');
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                testConnection();
                
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞: ' + error.message);
            }
        }
        
        async function testConnection() {
            log('3. –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
            
            if (!window.supabase) {
                log('‚ùå window.supabase –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                return;
            }
            
            try {
                const { data, error } = await window.supabase.auth.getSession();
                
                if (error) {
                    log('‚ùå –û—à–∏–±–∫–∞ getSession: ' + error.message);
                } else {
                    log('‚úÖ getSession —É—Å–ø–µ—à–µ–Ω');
                    if (data.session) {
                        log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ' + data.session.user.email);
                    } else {
                        log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                    }
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ' + error.message);
            }
        }
        
        // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('testBtn').onclick = testConnection;
        document.getElementById('checkBtn').onclick = function() {
            log('--- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ ---');
            log('window.supabase: ' + (window.supabase ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'));
            log('typeof supabase: ' + typeof supabase);
            log('supabase.createClient: ' + (supabase && supabase.createClient ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'));
        };
        document.getElementById('loginBtn').onclick = function() {
            log('–ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –Ω–∞–∂–∞—Ç–∞');
        };
        document.getElementById('logoutBtn').onclick = async function() {
            log('–ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –Ω–∞–∂–∞—Ç–∞');
            if (window.supabase) {
                const { error } = await window.supabase.auth.signOut();
                if (error) {
                    log('‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ' + error.message);
                } else {
                    log('‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
                }
            }
        };
    </script>
</body>
</html>