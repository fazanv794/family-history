<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>История моей семьи</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Шапка (скрыта до авторизации) -->
    <header id="main-header" class="hidden">
        <div class="header-container container">
            <a href="#" class="logo" id="home-link">
                <i class="fas fa-tree"></i>
                История моей семьи
            </a>
            
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="nav-links" id="nav-links">
                <li><a href="#" id="tree-link">Древо</a></li>
                <li><a href="#" id="timeline-link">Лента событий</a></li>
                <li><a href="#" id="media-link">Медиатека</a></li>
                <li><a href="#" id="profile-link">Мой профиль</a></li>
            </ul>
            
            <div class="user-menu">
                <span id="username">Гость</span>
                <div class="avatar" id="user-avatar">Г</div>
                <button class="btn btn-secondary" style="margin-left: 15px;" id="logout-btn">Выйти</button>
            </div>
        </div>
    </header>

    <!-- Главный контент -->
    <main id="main-content">
        <!-- Страница авторизации (видима по умолчанию) -->
        <section id="auth-page" class="page">
            <div class="auth-container">
                <div class="logo-large">
                    <i class="fas fa-tree"></i>
                    <h1>История моей семьи</h1>
                </div>
                
                <h2 id="auth-title">Вход в аккаунт</h2>
                
                <div class="auth-error" id="auth-error" style="display: none;"></div>
                
                <form class="auth-form" id="auth-form">
                    <div class="form-group">
                        <label for="auth-email">Email</label>
                        <input type="email" id="auth-email" placeholder="Введите ваш email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="auth-password">Пароль</label>
                        <input type="password" id="auth-password" placeholder="Введите пароль" required>
                    </div>
                    
                    <div class="form-group hidden" id="reg-name-group">
                        <label for="auth-name">Имя и фамилия</label>
                        <input type="text" id="auth-name" placeholder="Введите ваше имя">
                    </div>
                    
                    <div class="form-group hidden" id="reg-confirm-group">
                        <label for="auth-confirm-password">Подтверждение пароля</label>
                        <input type="password" id="auth-confirm-password" placeholder="Повторите пароль">
                    </div>
                    
                    <button type="submit" class="btn auth-submit-btn" style="width: 100%; margin-top: 20px;" id="auth-submit">
                        Войти
                    </button>
                </form>
                
                <div class="auth-switch">
                    <p id="auth-switch-text">
                        Нет аккаунта? 
                        <a href="#" id="auth-switch-link">
                            Зарегистрироваться
                        </a>
                    </p>
                </div>
                
                <div class="auth-features">
                    <div class="feature">
                        <i class="fas fa-sitemap"></i>
                        <span>Создавайте генеалогическое древо</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-images"></i>
                        <span>Храните семейные фотографии</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Отмечайте важные даты</span>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Главная страница (скрыта до авторизации) -->
        <section id="home-page" class="page hidden">
            <div class="hero">
                <div class="container">
                    <h1>Добро пожаловать в вашу семейную историю!</h1>
                    <p>Создайте генеалогическое древо, сохраните воспоминания, фотографии и истории для будущих поколений.</p>
                    <div class="hero-buttons">
                        <button class="btn" id="tree-btn">
                            <i class="fas fa-sitemap"></i> Моё древо
                        </button>
                        <button class="btn btn-secondary" id="add-person-btn">
                            <i class="fas fa-user-plus"></i> Добавить человека
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="container">
                <div class="quick-stats">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="stat-people">0</h3>
                        <p>Людей в древе</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar"></i>
                        <h3 id="stat-events">0</h3>
                        <p>Событий</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-images"></i>
                        <h3 id="stat-media">0</h3>
                        <p>Фотографий</p>
                    </div>
                </div>
                
                <div class="features">
                    <h2>Возможности приложения</h2>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-sitemap"></i>
                            </div>
                            <h3>Генеалогическое древо</h3>
                            <p>Создавайте интерактивное древо, добавляйте родственников, фотографии и биографии.</p>
                            <button class="btn btn-small tree-btn-2">Перейти</button>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <h3>Лента событий</h3>
                            <p>Отмечайте важные даты, дни рождения, свадьбы и другие семейные события.</p>
                            <button class="btn btn-small timeline-btn-2">Перейти</button>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-images"></i>
                            </div>
                            <h3>Медиатека</h3>
                            <p>Храните и организуйте семейные фотографии и документы.</p>
                            <button class="btn btn-small media-btn-2">Перейти</button>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <h3>Мой профиль</h3>
                            <p>Управляйте аккаунтом и настройками приложения.</p>
                            <button class="btn btn-small profile-btn-2">Перейти</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Страница древа -->
        <section id="tree-page" class="page hidden">
            <div class="container">
                <h2>Генеалогическое древо</h2>
                <div class="tree-controls">
                    <button class="btn" onclick="window.autoBuildTree()">
                        <i class="fas fa-magic"></i> Автопостроение
                    </button>
                    <button class="btn btn-secondary" id="add-person-tree-btn">
                        <i class="fas fa-user-plus"></i> Добавить человека
                    </button>
                    <button class="btn btn-secondary" id="save-tree-btn">
                        <i class="fas fa-save"></i> Сохранить как картинку
                    </button>
                </div>
                
                <div class="tree-auto-options">
                    <div class="form-group">
                        <label for="auto-generations">Поколения</label>
                        <select id="auto-generations">
                            <option value="3">3 поколения</option>
                            <option value="4">4 поколения</option>
                            <option value="5">5 поколений</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="auto-style">Стиль</label>
                        <select id="auto-style">
                            <option value="horizontal">Горизонтальный</option>
                            <option value="vertical">Вертикальный</option>
                            <option value="circular">Круговой</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="auto-center-person">Центр</label>
                        <select id="auto-center-person">
                            <option value="self">Я</option>
                            <option value="oldest">Самый старший</option>
                        </select>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="auto-show-photos" checked>
                        <label for="auto-show-photos">Показывать фото</label>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="auto-show-dates" checked>
                        <label for="auto-show-dates">Показывать даты</label>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="auto-show-lines" checked>
                        <label for="auto-show-lines">Показывать линии</label>
                    </div>
                </div>
                
                <div class="tree-visualization-container" id="tree-visualization-container">
                    <!-- Здесь будет дерево -->
                </div>
                
                <div class="tree-stats">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="tree-people-count">0</h3>
                        <p>Людей</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-images"></i>
                        <h3 id="tree-photos-count">0</h3>
                        <p>Фотографий</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-layer-group"></i>
                        <h3 id="tree-generations">0</h3>
                        <p>Поколений</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Страница ленты событий -->
        <section id="timeline-page" class="page hidden">
            <div class="container">
                <h2>Лента событий</h2>
                <button class="btn" id="add-event-btn">
                    <i class="fas fa-plus"></i> Добавить событие
                </button>
                
                <div class="timeline-container" id="timeline-container">
                    <!-- События здесь -->
                </div>
            </div>
        </section>
        
        <!-- Страница медиатеки -->
        <section id="media-page" class="page hidden">
            <div class="container">
                <h2>Медиатека</h2>
                <div class="media-controls">
                    <button class="btn" id="upload-media-btn">
                        <i class="fas fa-upload"></i> Загрузить фото
                    </button>
                    <input type="text" id="media-filter" placeholder="Поиск по описанию...">
                </div>
                
                <div class="media-grid" id="media-grid">
                    <!-- Фото здесь -->
                </div>
            </div>
        </section>
        
        <!-- Страница профиля -->
        <section id="profile-page" class="page hidden">
            <div class="container">
                <div class="profile-container">
                    <div class="profile-avatar">
                        <div class="avatar large" id="profile-avatar">П</div>
                        <h2 id="profile-name">Имя Фамилия</h2>
                        <p id="profile-email">email@example.com</p>
                    </div>
                    
                    <div class="profile-info">
                        <h3>Информация об аккаунте</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <i class="fas fa-envelope"></i>
                                <span>Email: <span id="info-email"></span></span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-user"></i>
                                <span>ID: <span id="info-user-id"></span></span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-calendar"></i>
                                <span>Регистрация: <span id="info-reg-date"></span></span>
                            </div>
                        </div>
                        
                        <h3>Действия</h3>
                        <button class="btn full-width" id="edit-profile-btn">
                            <i class="fas fa-edit"></i> Редактировать профиль
                        </button>
                        <button class="btn btn-secondary full-width" id="invite-btn">
                            <i class="fas fa-user-plus"></i> Пригласить родственника
                        </button>
                        <button class="btn btn-danger full-width" id="logout-profile-btn">
                            <i class="fas fa-sign-out-alt"></i> Выйти
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Модальное окно добавления человека -->
    <div id="add-person-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Добавить человека</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-person-form-modal">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="person-first-name">Имя *</label>
                            <input type="text" id="person-first-name" placeholder="Имя" required>
                        </div>
                        <div class="form-group">
                            <label for="person-last-name">Фамилия</label>
                            <input type="text" id="person-last-name" placeholder="Фамилия">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="person-birth-date">Дата рождения</label>
                            <input type="date" id="person-birth-date">
                        </div>
                        <div class="form-group">
                            <label for="person-death-date">Дата смерти</label>
                            <input type="date" id="person-death-date">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-gender">Пол</label>
                        <select id="person-gender">
                            <option value="">Не указан</option>
                            <option value="male">Мужской</option>
                            <option value="female">Женский</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-photo">Фото (URL или файл)</label>
                        <input type="file" id="person-photo" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <label for="person-relation">Родство *</label>
                        <select id="person-relation">
                            <option value="self">Я</option>
                            <option value="spouse">Супруг/а</option>
                            <option value="parent">Родитель</option>
                            <option value="child">Ребенок</option>
                            <option value="sibling">Брат/сестра</option>
                            <option value="grandparent">Дедушка/бабушка</option>
                            <option value="grandchild">Внук/внучка</option>
                            <option value="other">Другой родственник</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-bio">Биография (необязательно)</label>
                        <textarea id="person-bio" rows="3" placeholder="Краткая информация о человеке..."></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary cancel-btn">
                            Отмена
                        </button>
                        <button type="submit" class="btn">
                            Добавить в древо
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно добавления события -->
    <div id="add-event-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Добавить семейное событие</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-event-form-modal">
                    <div class="form-group">
                        <label for="event-title">Название события *</label>
                        <input type="text" id="event-title" placeholder="Например: День рождения мамы" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="event-date">Дата события *</label>
                        <input type="date" id="event-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="event-description">Описание</label>
                        <textarea id="event-description" rows="3" placeholder="Подробности события..."></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary cancel-btn">
                            Отмена
                        </button>
                        <button type="submit" class="btn">
                            Добавить событие
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно загрузки медиа -->
    <div id="upload-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Загрузить медиафайлы</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="upload-form-modal">
                    <div class="form-group">
                        <label for="upload-files">Выберите файлы</label>
                        <input type="file" id="upload-files" multiple accept="image/*" class="file-input">
                        <div class="file-hint">Можно выбрать несколько фотографий</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="upload-description">Описание (необязательно)</label>
                        <input type="text" id="upload-description" placeholder="Что на фото?">
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary cancel-btn">
                            Отмена
                        </button>
                        <button type="submit" class="btn">
                            <i class="fas fa-upload"></i> Загрузить
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно приглашения -->
    <div id="invite-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Пригласить родственника</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="invite-form-modal">
                    <div class="form-group">
                        <label for="invite-email">Email родственника *</label>
                        <input type="email" id="invite-email" placeholder="email@example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="invite-message">Сообщение (необязательно)</label>
                        <textarea id="invite-message" rows="3" placeholder="Привет! Присоединяйся к нашему семейному древу..."></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary cancel-btn">
                            Отмена
                        </button>
                        <button type="submit" class="btn">
                            Отправить приглашение
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Уведомления -->
    <div id="notification" class="notification hidden">
        <div class="notification-content">
            <span id="notification-text"></span>
            <button class="notification-close">&times;</button>
        </div>
    </div>

    <!-- Загрузчик -->
    <div id="loader" class="loader-overlay hidden">
        <div class="loader"></div>
        <div class="loader-text" id="loader-text">Загрузка...</div>
    </div>

    <!-- Подключаем библиотеки -->
    <!-- Для сохранения дерева как картинки -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Подключаем наши файлы -->
    <script src="supabase.js"></script>
    <script src="tree-engine.js"></script> <!-- FIX: Добавил подключение tree-engine.js -->
    <script src="app.js"></script>
</body>
</html>