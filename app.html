<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–∞–≤–Ω–∞—è - –ò—Å—Ç–æ—Ä–∏—è –º–æ–µ–π —Å–µ–º—å–∏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- –®–∞–ø–∫–∞ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <header id="app-header">
        <div class="header-container container">
            <a href="app.html" class="logo" id="home-link">
                <i class="fas fa-tree"></i>
                –ò—Å—Ç–æ—Ä–∏—è –º–æ–µ–π —Å–µ–º—å–∏
            </a>
            
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="nav-links" id="nav-links">
                <li><a href="app.html" class="active">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="tree.html">–î—Ä–µ–≤–æ</a></li>
                <li><a href="timeline.html">–õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π</a></li>
                <li><a href="media.html">–ú–µ–¥–∏–∞—Ç–µ–∫–∞</a></li>
                <li><a href="profile.html">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a></li>
            </ul>
            
            <div class="user-menu">
                <span id="username">–ì–æ—Å—Ç—å</span>
                <div class="avatar" id="user-avatar">–ì</div>
                <button class="btn btn-small" id="logout-btn">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </header>

    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <main id="app-content">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <section id="home-page" class="page">
            <div class="hero">
                <div class="container">
                    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à—É —Å–µ–º–µ–π–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é!</h1>
                    <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –≥–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥—Ä–µ–≤–æ, —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö –ø–æ–∫–æ–ª–µ–Ω–∏–π.</p>
                    <div class="hero-buttons">
                        <a href="tree.html" class="btn" id="tree-btn">
                            <i class="fas fa-sitemap"></i> –°–æ–∑–¥–∞—Ç—å –¥—Ä–µ–≤–æ
                        </a>
                        <button class="btn btn-secondary" id="add-person-btn">
                            <i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="container">
                <div class="quick-stats">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="stat-people">0</h3>
                        <p>–õ—é–¥–µ–π –≤ –¥—Ä–µ–≤–µ</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar"></i>
                        <h3 id="stat-events">0</h3>
                        <p>–°–æ–±—ã—Ç–∏–π</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-images"></i>
                        <h3 id="stat-media">0</h3>
                        <p>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-layer-group"></i>
                        <h3 id="stat-generations">0</h3>
                        <p>–ü–æ–∫–æ–ª–µ–Ω–∏–π</p>
                    </div>
                </div>
                
                <div class="recent-activity">
                    <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h2>
                    <div id="recent-events-list">
                        <!-- –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <footer>
        <div class="container">
            <div class="copyright">
                <p>¬© 2024 –ò—Å—Ç–æ—Ä–∏—è –º–æ–µ–π —Å–µ–º—å–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal-overlay hidden" id="modal-overlay"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞ -->
    <div id="add-person-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ –≤ –¥—Ä–µ–≤–æ</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-person-form-modal">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="person-first-name">–ò–º—è *</label>
                            <input type="text" id="person-first-name" placeholder="–ò–º—è" required>
                        </div>
                        <div class="form-group">
                            <label for="person-last-name">–§–∞–º–∏–ª–∏—è *</label>
                            <input type="text" id="person-last-name" placeholder="–§–∞–º–∏–ª–∏—è" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="person-birth-date">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                            <input type="date" id="person-birth-date">
                        </div>
                        <div class="form-group">
                            <label for="person-death-date">–î–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏</label>
                            <input type="date" id="person-death-date">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-gender">–ü–æ–ª</label>
                        <select id="person-gender" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                            <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                            <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-relation">–†–æ–¥—Å—Ç–≤–æ *</label>
                        <select id="person-relation" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥—Å—Ç–≤–æ</option>
                            <option value="self">–Ø</option>
                            <option value="spouse">–°—É–ø—Ä—É–≥/–∞</option>
                            <option value="parent">–†–æ–¥–∏—Ç–µ–ª—å</option>
                            <option value="child">–†–µ–±–µ–Ω–æ–∫</option>
                            <option value="sibling">–ë—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞</option>
                            <option value="grandparent">–î–µ–¥—É—à–∫–∞/–±–∞–±—É—à–∫–∞</option>
                            <option value="grandchild">–í–Ω—É–∫/–≤–Ω—É—á–∫–∞</option>
                            <option value="aunt_uncle">–¢–µ—Ç—è/–¥—è–¥—è</option>
                            <option value="cousin">–î–≤–æ—é—Ä–æ–¥–Ω—ã–π –±—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞</option>
                            <option value="other">–î—Ä—É–≥–æ–π —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-photo-url">–§–æ—Ç–æ (URL)</label>
                        <input type="url" id="person-photo-url" placeholder="https://example.com/photo.jpg">
                        <small style="color: #718096;">–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-bio">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</label>
                        <textarea id="person-bio" rows="4" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞..."></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary cancel-btn">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button type="submit" class="btn">
                            –î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä–µ–≤–æ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <span id="notification-text"></span>
            <button class="notification-close">&times;</button>
        </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑—á–∏–∫ -->
    <div id="loader" class="loader-overlay hidden">
        <div class="loader"></div>
        <div class="loader-text" id="loader-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à–∏ —Ñ–∞–π–ª—ã -->
    <script src="supabase.js"></script>
    <script src="app.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
                const { data: { user }, error } = await window.supabaseClient.auth.getUser();
                
                if (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                    window.location.href = 'auth.html';
                    return;
                }
                
                if (!user) {
                    window.location.href = 'auth.html';
                    return;
                }
                
                console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', user.email);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const displayName = user.user_metadata?.name || user.user_metadata?.full_name || user.email?.split('@')[0] || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('username').textContent = displayName;
                document.getElementById('user-avatar').textContent = getUserInitials(displayName);
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                setupEventListeners();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await loadUserData();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', error);
                window.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã', 'error');
            }
        });
        
        function getUserInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }
        
        function setupEventListeners() {
            // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
            document.getElementById('mobile-menu-btn')?.addEventListener('click', () => {
                document.getElementById('nav-links').classList.toggle('active');
            });
            
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞
            document.getElementById('add-person-btn')?.addEventListener('click', () => {
                document.getElementById('add-person-modal').classList.remove('hidden');
                document.getElementById('modal-overlay').classList.remove('hidden');
            });
            
            // –í—ã—Ö–æ–¥
            document.getElementById('logout-btn')?.addEventListener('click', async () => {
                try {
                    const { error } = await window.supabaseClient.auth.signOut();
                    if (error) throw error;
                    
                    window.showNotification('‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
                    window.showNotification('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'error');
                }
            });
            
            // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ - –∑–∞–∫—Ä—ã—Ç–∏–µ
            document.querySelectorAll('.modal-close, .cancel-btn').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });
            
            document.getElementById('modal-overlay')?.addEventListener('click', closeAllModals);
            
            // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞
            document.getElementById('add-person-form-modal')?.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const firstName = document.getElementById('person-first-name').value;
                const lastName = document.getElementById('person-last-name').value;
                const birthDate = document.getElementById('person-birth-date').value;
                const deathDate = document.getElementById('person-death-date').value;
                const gender = document.getElementById('person-gender').value;
                const relation = document.getElementById('person-relation').value;
                const photoUrl = document.getElementById('person-photo-url').value;
                const biography = document.getElementById('person-bio').value;
                
                if (!firstName || !lastName || !gender || !relation) {
                    window.showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                    return;
                }
                
                window.showLoader('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞...');
                
                try {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const { data: { user } } = await window.supabaseClient.auth.getUser();
                    
                    const newPerson = {
                        first_name: firstName,
                        last_name: lastName,
                        birth_date: birthDate || null,
                        death_date: deathDate || null,
                        gender: gender,
                        relation: relation,
                        photo_url: photoUrl || null,
                        biography: biography || null,
                        user_id: user.id
                    };
                    
                    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                    // –î–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    
                    setTimeout(() => {
                        window.showNotification('‚úÖ –ß–µ–ª–æ–≤–µ–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                        closeAllModals();
                        document.getElementById('add-person-form-modal').reset();
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        updateStats();
                        
                    }, 1500);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞:', error);
                    window.showNotification('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞', 'error');
                } finally {
                    window.hideLoader();
                }
            });
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.add('hidden');
            });
            document.getElementById('modal-overlay').classList.add('hidden');
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
        let people = [];
        let events = [];
        let media = [];
        
        async function loadUserData() {
            try {
                window.showLoader('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                
                const { data: { user } } = await window.supabaseClient.auth.getUser();
                const userId = user.id;
                
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase
                // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                
                people = [
                    {
                        id: '1',
                        first_name: '–ò–≤–∞–Ω',
                        last_name: '–ò–≤–∞–Ω–æ–≤',
                        birth_date: '1990-01-15',
                        gender: 'male',
                        relation: 'self'
                    },
                    {
                        id: '2',
                        first_name: '–ú–∞—Ä–∏—è',
                        last_name: '–ò–≤–∞–Ω–æ–≤–∞',
                        birth_date: '1992-03-22',
                        gender: 'female',
                        relation: 'spouse'
                    }
                ];
                
                events = [
                    {
                        id: '1',
                        title: '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –ê–ª–µ–∫—Å–µ—è',
                        date: '2024-07-10',
                        event_type: 'birthday',
                        description: '–ü—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏–µ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è —Å—ã–Ω–∞'
                    },
                    {
                        id: '2',
                        title: '–°–µ–º–µ–π–Ω—ã–π –ø–∏–∫–Ω–∏–∫',
                        date: '2024-08-15',
                        event_type: 'holiday',
                        description: '–ï–∂–µ–≥–æ–¥–Ω—ã–π —Å–µ–º–µ–π–Ω—ã–π –ø–∏–∫–Ω–∏–∫ –≤ –ª–µ—Å—É'
                    }
                ];
                
                media = [
                    {
                        id: '1',
                        file_url: 'https://images.unsplash.com/photo-1511988617509-a57c8a288659?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80',
                        description: '–°–µ–º–µ–π–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ'
                    }
                ];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateStats();
                updateRecentEvents();
                
                window.showNotification('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                window.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º.', 'error');
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                generateDemoData();
                updateStats();
                updateRecentEvents();
            } finally {
                window.hideLoader();
            }
        }
        
        function generateDemoData() {
            people = [
                {
                    id: '1',
                    first_name: '–ò–≤–∞–Ω',
                    last_name: '–ò–≤–∞–Ω–æ–≤',
                    birth_date: '1990-01-15',
                    gender: 'male',
                    relation: 'self'
                },
                {
                    id: '2',
                    first_name: '–ú–∞—Ä–∏—è',
                    last_name: '–ò–≤–∞–Ω–æ–≤–∞',
                    birth_date: '1992-03-22',
                    gender: 'female',
                    relation: 'spouse'
                },
                {
                    id: '3',
                    first_name: '–ê–ª–µ–∫—Å–µ–π',
                    last_name: '–ò–≤–∞–Ω–æ–≤',
                    birth_date: '2015-07-10',
                    gender: 'male',
                    relation: 'child'
                }
            ];
            
            events = [
                {
                    id: '1',
                    title: '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –ê–ª–µ–∫—Å–µ—è',
                    date: '2024-07-10',
                    event_type: 'birthday',
                    description: '–ü—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏–µ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è —Å—ã–Ω–∞'
                }
            ];
            
            media = [
                {
                    id: '1',
                    file_url: 'https://images.unsplash.com/photo-1511988617509-a57c8a288659?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80',
                    description: '–°–µ–º–µ–π–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ'
                }
            ];
        }
        
        function updateStats() {
            document.getElementById('stat-people').textContent = people.length;
            document.getElementById('stat-events').textContent = events.length;
            document.getElementById('stat-media').textContent = media.length;
            document.getElementById('stat-generations').textContent = calculateGenerations();
        }
        
        function calculateGenerations() {
            if (people.length === 0) return 0;
            
            // –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç –ø–æ–∫–æ–ª–µ–Ω–∏–π
            const hasGrandparents = people.some(p => p.relation === 'grandparent');
            const hasGrandchildren = people.some(p => p.relation === 'grandchild');
            
            let generations = 1; // –¢–µ–∫—É—â–µ–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ
            if (hasGrandparents) generations++;
            if (hasGrandchildren) generations++;
            
            return generations;
        }
        
        function updateRecentEvents() {
            const container = document.getElementById('recent-events-list');
            if (!container) return;
            
            const recentEvents = events.slice(0, 5);
            
            if (recentEvents.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #718096; padding: 20px;">–°–æ–±—ã—Ç–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }
            
            let html = '';
            recentEvents.forEach(event => {
                const date = new Date(event.date).toLocaleDateString('ru-RU');
                const icon = getEventIcon(event.event_type);
                
                html += `
                    <div class="timeline-event" style="display: flex; gap: 15px; margin-bottom: 15px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <div class="event-icon" style="background: #667eea; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="${icon}"></i>
                        </div>
                        <div class="event-content" style="flex: 1;">
                            <h3 style="margin-bottom: 5px; color: #2d3748;">${event.title}</h3>
                            <div class="event-date" style="color: #718096; font-size: 0.9rem; margin-bottom: 10px;">${date}</div>
                            ${event.description ? `<p style="color: #4a5568;">${event.description}</p>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function getEventIcon(eventType) {
            const icons = {
                'birthday': 'fas fa-birthday-cake',
                'wedding': 'fas fa-ring',
                'anniversary': 'fas fa-heart',
                'holiday': 'fas fa-gift',
                'other': 'fas fa-calendar'
            };
            
            return icons[eventType] || 'fas fa-calendar';
        }
    </script>
</body>
</html>