<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥—Ä–µ–≤–æ - –ò—Å—Ç–æ—Ä–∏—è –º–æ–µ–π —Å–µ–º—å–∏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- –®–∞–ø–∫–∞ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <header id="app-header">
        <div class="header-container container">
            <a href="app.html" class="logo" id="home-link">
                <i class="fas fa-tree"></i>
                –ò—Å—Ç–æ—Ä–∏—è –º–æ–µ–π —Å–µ–º—å–∏
            </a>
            
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="nav-links" id="nav-links">
                <li><a href="app.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="tree.html" class="active">–î—Ä–µ–≤–æ</a></li>
                <li><a href="timeline.html">–õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π</a></li>
                <li><a href="media.html">–ú–µ–¥–∏–∞—Ç–µ–∫–∞</a></li>
                <li><a href="profile.html">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a></li>
            </ul>
            
            <div class="user-menu">
                <span id="username">–ì–æ—Å—Ç—å</span>
                <div class="avatar" id="user-avatar">–ì</div>
                <button class="btn btn-small" id="logout-btn">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </header>

    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <main id="app-content">
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥—Ä–µ–≤–∞ -->
        <section id="tree-page" class="page">
            <div class="container">
                <h2>–ì–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥—Ä–µ–≤–æ</h2>
                
                <div class="tree-controls">
                    <button class="btn" id="auto-build-btn">
                        <i class="fas fa-magic"></i> –ê–≤—Ç–æ–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ
                    </button>
                    <button class="btn btn-secondary" id="manual-add-btn">
                        <i class="fas fa-hand-pointer"></i> –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
                    </button>
                    <button class="btn btn-secondary" id="save-image-btn">
                        <i class="fas fa-image"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –∫–∞—Ä—Ç–∏–Ω–∫—É
                    </button>
                    <button class="btn btn-secondary" id="print-tree-btn">
                        <i class="fas fa-print"></i> –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å
                    </button>
                </div>
                
                <div class="tree-auto-options">
                    <div class="form-group">
                        <label for="auto-generations">–ü–æ–∫–æ–ª–µ–Ω–∏—è</label>
                        <select id="auto-generations">
                            <option value="2">2 –ø–æ–∫–æ–ª–µ–Ω–∏—è</option>
                            <option value="3" selected>3 –ø–æ–∫–æ–ª–µ–Ω–∏—è</option>
                            <option value="4">4 –ø–æ–∫–æ–ª–µ–Ω–∏—è</option>
                            <option value="5">5 –ø–æ–∫–æ–ª–µ–Ω–∏–π</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-relation">–†–æ–¥—Å—Ç–≤–æ *</label>
                        <select id="person-relation" class="relation-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥—Å—Ç–≤–æ</option>
                            <option value="self">–Ø (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞)</option>
                            <option value="spouse">–°—É–ø—Ä—É–≥/—Å—É–ø—Ä—É–≥–∞</option>
                            <option value="parent">–†–æ–¥–∏—Ç–µ–ª—å</option>
                            <option value="child">–†–µ–±–µ–Ω–æ–∫</option>
                            <option value="sibling">–ë—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞</option>
                            <option value="grandparent">–î–µ–¥—É—à–∫–∞/–±–∞–±—É—à–∫–∞</option>
                            <option value="grandchild">–í–Ω—É–∫/–≤–Ω—É—á–∫–∞</option>
                            <option value="great_grandparent">–ü—Ä–∞–¥–µ–¥—É—à–∫–∞/–ø—Ä–∞–±–∞–±—É—à–∫–∞</option>
                            <option value="great_grandchild">–ü—Ä–∞–≤–Ω—É–∫/–ø—Ä–∞–≤–Ω—É—á–∫–∞</option>
                            <option value="aunt_uncle">–¢–µ—Ç—è/–¥—è–¥—è</option>
                            <option value="cousin">–î–≤–æ—é—Ä–æ–¥–Ω—ã–π –±—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞</option>
                            <option value="nephew_niece">–ü–ª–µ–º—è–Ω–Ω–∏–∫/–ø–ª–µ–º—è–Ω–Ω–∏—Ü–∞</option>
                            <option value="uncle_aunt">–î—è–¥—è/—Ç–µ—Ç—è</option>
                            <option value="other">–î—Ä—É–≥–æ–π —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="auto-center-person">–¶–µ–Ω—Ç—Ä –¥—Ä–µ–≤–∞</label>
                        <select id="auto-center-person">
                            <option value="self" selected>–Ø</option>
                            <option value="oldest">–°–∞–º—ã–π —Å—Ç–∞—Ä—à–∏–π</option>
                            <option value="founder">–û—Å–Ω–æ–≤–∞—Ç–µ–ª—å —Ä–æ–¥–∞</option>
                        </select>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="auto-show-photos" checked>
                        <label for="auto-show-photos">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–æ—Ç–æ</label>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="auto-show-dates" checked>
                        <label for="auto-show-dates">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—ã</label>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="auto-show-lines" checked>
                        <label for="auto-show-lines">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏–Ω–∏–∏ —Å–≤—è–∑–∏</label>
                    </div>
                </div>
                
                <div class="tree-visualization-container" id="tree-visualization-container">
                    <div class="tree-empty-state">
                        <i class="fas fa-tree" style="font-size: 4rem; color: #cbd5e0; margin-bottom: 20px;"></i>
                        <h3>–î–µ—Ä–µ–≤–æ –µ—â–µ –Ω–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ</h3>
                        <p>–ù–∞–∂–º–∏—Ç–µ "–ê–≤—Ç–æ–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ" —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –≤–∞—à–µ –ø–µ—Ä–≤–æ–µ –≥–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥—Ä–µ–≤–æ</p>
                        <button class="btn" id="auto-build-btn-2" style="margin-top: 20px;">
                            <i class="fas fa-magic"></i> –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–µ—Ä–µ–≤–æ
                        </button>
                    </div>
                </div>
                
                <div class="tree-stats">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="tree-people-count">0</h3>
                        <p>–õ—é–¥–µ–π</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-images"></i>
                        <h3 id="tree-photos-count">0</h3>
                        <p>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-layer-group"></i>
                        <h3 id="tree-generations">0</h3>
                        <p>–ü–æ–∫–æ–ª–µ–Ω–∏–π</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-link"></i>
                        <h3 id="tree-connections">0</h3>
                        <p>–°–≤—è–∑–µ–π</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <footer>
        <div class="container">
            <div class="copyright">
                <p>¬© 2024 –ò—Å—Ç–æ—Ä–∏—è –º–æ–µ–π —Å–µ–º—å–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal-overlay hidden" id="modal-overlay"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞ -->
    <div id="add-person-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ –≤ –¥—Ä–µ–≤–æ</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-person-form-modal">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="person-first-name">–ò–º—è *</label>
                            <input type="text" id="person-first-name" placeholder="–ò–º—è" required>
                        </div>
                        <div class="form-group">
                            <label for="person-last-name">–§–∞–º–∏–ª–∏—è *</label>
                            <input type="text" id="person-last-name" placeholder="–§–∞–º–∏–ª–∏—è" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="person-birth-date">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                            <input type="date" id="person-birth-date">
                        </div>
                        <div class="form-group">
                            <label for="person-death-date">–î–∞—Ç–∞ —Å–º–µ—Ä—Ç–∏</label>
                            <input type="date" id="person-death-date">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-gender">–ü–æ–ª</label>
                        <select id="person-gender" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                            <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                            <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-relation">–†–æ–¥—Å—Ç–≤–æ *</label>
                        <select id="person-relation" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥—Å—Ç–≤–æ</option>
                            <option value="self">–Ø</option>
                            <option value="spouse">–°—É–ø—Ä—É–≥/–∞</option>
                            <option value="parent">–†–æ–¥–∏—Ç–µ–ª—å</option>
                            <option value="child">–†–µ–±–µ–Ω–æ–∫</option>
                            <option value="sibling">–ë—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞</option>
                            <option value="grandparent">–î–µ–¥—É—à–∫–∞/–±–∞–±—É—à–∫–∞</option>
                            <option value="grandchild">–í–Ω—É–∫/–≤–Ω—É—á–∫–∞</option>
                            <option value="aunt_uncle">–¢–µ—Ç—è/–¥—è–¥—è</option>
                            <option value="cousin">–î–≤–æ—é—Ä–æ–¥–Ω—ã–π –±—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞</option>
                            <option value="other">–î—Ä—É–≥–æ–π —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-photo-url">–§–æ—Ç–æ (URL)</label>
                        <input type="url" id="person-photo-url" placeholder="https://example.com/photo.jpg">
                        <small style="color: #718096;">–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="person-bio">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</label>
                        <textarea id="person-bio" rows="4" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞..."></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary cancel-btn">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button type="submit" class="btn">
                            –î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä–µ–≤–æ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <span id="notification-text"></span>
            <button class="notification-close">&times;</button>
        </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑—á–∏–∫ -->
    <div id="loader" class="loader-overlay hidden">
        <div class="loader"></div>
        <div class="loader-text" id="loader-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à–∏ —Ñ–∞–π–ª—ã -->
    <script src="supabase.js"></script>
    <script src="tree-engine.js"></script>
    <script src="app.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üå≥ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ä–µ–≤–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –û–ñ–ò–î–ê–ï–ú –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const checkAuth = () => {
                if (!window.currentUser) {
                    console.log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                    window.showNotification('–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                    setTimeout(() => {
                        window.location.href = 'auth.html';
                    }, 1500);
                    return false;
                }
                console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', window.currentUser.email);
                return true;
            };
            
            // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            setTimeout(() => {
                if (!checkAuth()) return;
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                document.getElementById('auto-build-btn')?.addEventListener('click', () => {
                    if (!window.currentUser) {
                        window.showNotification('–î–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                        setTimeout(() => {
                            window.location.href = 'auth.html';
                        }, 1500);
                        return;
                    }
                    if (window.autoBuildTree) autoBuildTree();
                });
                
                document.getElementById('auto-build-btn-2')?.addEventListener('click', () => {
                    if (!window.currentUser) {
                        window.showNotification('–î–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                        setTimeout(() => {
                            window.location.href = 'auth.html';
                        }, 1500);
                        return;
                    }
                    if (window.autoBuildTree) autoBuildTree();
                });
                
                document.getElementById('manual-add-btn')?.addEventListener('click', () => {
                    if (!window.currentUser) {
                        window.showNotification('–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                        setTimeout(() => {
                            window.location.href = 'auth.html';
                        }, 1500);
                        return;
                    }
                    window.showModal('add-person-modal');
                });
                
                document.getElementById('save-image-btn')?.addEventListener('click', () => {
                    if (!window.currentUser) {
                        window.showNotification('–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                        setTimeout(() => {
                            window.location.href = 'auth.html';
                        }, 1500);
                        return;
                    }
                    if (window.saveTreeAsImage) saveTreeAsImage();
                });
                
                document.getElementById('print-tree-btn')?.addEventListener('click', () => {
                    if (!window.currentUser) {
                        window.showNotification('–î–ª—è –ø–µ—á–∞—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                        setTimeout(() => {
                            window.location.href = 'auth.html';
                        }, 1500);
                        return;
                    }
                    if (window.printTree) printTree();
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (window.updateTreeStats) {
                    updateTreeStats();
                }
                
                console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ä–µ–≤–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            }, 300); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        });
    </script>
</body>
</html>